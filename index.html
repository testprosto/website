<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Free Games Tracker</title>
<style>
    body { font-family: Arial, sans-serif; background: #121212; color: #f0f0f0; margin: 0; padding: 0; }
    header { background: #1f1f1f; padding: 20px; text-align: center; }
    h1 { margin: 0; font-size: 2rem; color: #ffcc00; }
    section { padding: 20px; }
    h2 { color: #00ccff; }
    .game { display: flex; align-items: center; margin-bottom: 15px; background: #1a1a1a; padding: 10px; border-radius: 8px; }
    .game img { width: 80px; height: 80px; object-fit: cover; border-radius: 8px; margin-right: 15px; }
    .game-info { flex: 1; }
    .game-info a { color: #ffcc00; text-decoration: none; font-weight: bold; }
    .game-info a:hover { text-decoration: underline; }
    .expires { font-size: 0.9rem; color: #bbb; }
    hr { border: none; border-top: 1px solid #333; margin: 20px 0; }
</style>
</head>
<body>
<header>
    <h1>Free Games Tracker</h1>
    <p>Shows games that are still available or expired (Armenia time UTC+4)</p>
</header>

<section id="available">
    <h2>Available Games</h2>
    <div id="available-list"></div>
</section>

<section id="expired">
    <h2>Expired Games</h2>
    <div id="expired-list"></div>
</section>

<script>
// URLs to fetch games from
const urls = [
    "https://freetokeep.gg/data/epic.json",
    "https://freetokeep.gg/data/steam.json",
    "https://freetokeep.gg/data/gog.json",
    "https://freetokeep.gg/data/itch.json",
    "https://freetokeep.gg/data/stove.json",
    "https://freetokeep.gg/data/fanatical.json",
    "https://freetokeep.gg/data/prime.json",
    "https://freetokeep.gg/data/limited.json"
];

// Armenia timezone offset (UTC+4)
const armeniaOffset = 4 * 60; // in minutes

// Utility: format date
function formatDate(date) {
    return date.toLocaleString('en-GB', { hour12: false });
}

// Fetch all games
async function fetchGames() {
    const allGames = [];
    for (const url of urls) {
        try {
            const res = await fetch(url);
            if (!res.ok) continue;
            const data = await res.json();
            allGames.push(...data);
        } catch (e) {
            console.warn(`Error fetching ${url}: ${e}`);
        }
    }
    return allGames;
}

// Main
async function displayGames() {
    const games = await fetchGames();
    const now = new Date();
    now.setMinutes(now.getMinutes() + armeniaOffset - now.getTimezoneOffset()); // Armenia time

    const availableList = document.getElementById("available-list");
    const expiredList = document.getElementById("expired-list");

    const availableGames = [];
    const expiredGames = [];

    games.forEach(game => {
        if (!game.expires) return; // skip if no expires field
        const expiresUTC = new Date(game.expires);
        const expiresArmenia = new Date(expiresUTC.getTime() + armeniaOffset*60*1000);
        const gameEl = `
            <div class="game">
                <img src="${game.image}" alt="${game.title}">
                <div class="game-info">
                    <a href="${game.url}" target="_blank">${game.title}</a>
                    <div class="expires">${now < expiresArmenia ? 'Expires' : 'Expired'}: ${formatDate(expiresArmenia)}</div>
                </div>
            </div>
        `;
        if (now < expiresArmenia) availableGames.push(gameEl);
        else expiredGames.push(gameEl);
    });

    availableList.innerHTML = availableGames.length ? availableGames.join("") : "<p>No available games right now.</p>";
    expiredList.innerHTML = expiredGames.length ? expiredGames.join("") : "<p>No expired games found.</p>";
}

displayGames();
</script>
</body>
</html>
